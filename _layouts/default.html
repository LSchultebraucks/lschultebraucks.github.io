<!doctype html>
<html>

{% include head.html %}

<body>

  <div class="container">
    {% include header.html %}

    <div class="post-container">
      {{ content }}
    </div>

    {% include footer.html %}

  </div>

  <script>
    (function() {
      function applyIcon() {
        var isDark = document.documentElement.classList.contains('theme-dark');
        var btn = document.getElementById('theme-toggle');
        if (!btn) return;
        // Only set state attributes; icons are handled via CSS based on aria-pressed
        btn.setAttribute('aria-pressed', isDark ? 'true' : 'false');
        btn.title = isDark ? 'Helles Theme aktivieren' : 'Dunkles Theme aktivieren';
      }
      function toggleTheme() {
        var root = document.documentElement;
        var btn = document.getElementById('theme-toggle');
        var isDark = root.classList.contains('theme-dark');
        var next = isDark ? 'light' : 'dark';

        // Add pulse animation
        if (btn) btn.classList.add('changing');

        root.classList.remove('theme-dark','theme-light');
        root.classList.add(next === 'dark' ? 'theme-dark' : 'theme-light');
        try { localStorage.setItem('theme', next); } catch(e) {}
        applyIcon();

        // Remove pulse animation after completion
        if (btn) setTimeout(() => btn.classList.remove('changing'), 300);
      }
      document.addEventListener('DOMContentLoaded', function() {
        var btn = document.getElementById('theme-toggle');
        if (btn) {
          btn.addEventListener('click', toggleTheme);
          applyIcon();
        }
      });
    })();

    // Experience calculation
    (function() {
      function calculateYearsExperience(startDateStr) {
        if (!startDateStr) return null;

        var startDate = new Date(startDateStr);
        var today = new Date();

        var years = today.getFullYear() - startDate.getFullYear();
        var months = today.getMonth() - startDate.getMonth();

        // Adjust if birthday hasn't occurred yet this year
        if (months < 0 || (months === 0 && today.getDate() < startDate.getDate())) {
          years--;
        }

        return years;
      }

      function updateExperienceText() {
        var el = document.getElementById('years-experience');
        if (!el) return;

        var startDate = el.getAttribute('data-start-date');
        var years = calculateYearsExperience(startDate);

        if (years !== null && years > 0) {
          el.textContent = 'over ' + years + ' year' + (years === 1 ? '' : 's');
        }
      }

      // Run on page load
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', updateExperienceText);
      } else {
        updateExperienceText();
      }
    })();

    // Scroll animations
    (function() {
      if (!('IntersectionObserver' in window)) return;

      const animateOnScroll = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add('animate-in');
            }
          });
        },
        { threshold: 0.1, rootMargin: '0px 0px -50px 0px' }
      );

      document.addEventListener('DOMContentLoaded', () => {
        const elements = document.querySelectorAll('.post-item, .posts h1, .post-container > *');
        elements.forEach(el => {
          el.classList.add('animate-on-scroll');
          animateOnScroll.observe(el);
        });
      });
    })();

    // Page transitions
    (function() {
      document.addEventListener('DOMContentLoaded', () => {
        document.body.classList.add('page-loaded');
      });

      document.addEventListener('click', (e) => {
        const link = e.target.closest('a');
        if (link && link.href && !link.target && link.hostname === window.location.hostname) {
          e.preventDefault();
          document.body.classList.add('page-transitioning');
          setTimeout(() => { window.location = link.href; }, 250);
        }
      });
    })();
  </script>

</body>
</html>
